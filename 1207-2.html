<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>2048 貪食蛇 - HTML5 基礎版</title>
<style>
    body { background:#222; display:flex; justify-content:center; margin-top:40px; }
    canvas { background:#111; border:3px solid #666; }
</style>
</head>
<body>

<canvas id="game" width="500" height="500"></canvas>

<script>
/* -----------------------------
   基本設定
--------------------------------*/
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GRID = 25;                // 每格大小
const COL = canvas.width / GRID;
const ROW = canvas.height / GRID;

/* -----------------------------
   蛇物件
--------------------------------*/
let snake = [{
    x: 10,
    y: 10,
    dir: {x:1, y:0}
}];

let speed = 150;  // 蛇的速度(ms)
let lastMove = 0;

/* -----------------------------
   產生方塊（含數值）
--------------------------------*/
let tile = spawnTile();

function spawnTile() {
    return {
        x: Math.floor(Math.random()*COL),
        y: Math.floor(Math.random()*ROW),
        value: 2
    };
}

/* -----------------------------
   鍵盤控制蛇方向
--------------------------------*/
document.addEventListener("keydown", (e)=>{
    if (e.key === "ArrowUp" && snake[0].dir.y !== 1)
        snake[0].dir = {x:0, y:-1};
    if (e.key === "ArrowDown" && snake[0].dir.y !== -1)
        snake[0].dir = {x:0, y:1};
    if (e.key === "ArrowLeft" && snake[0].dir.x !== 1)
        snake[0].dir = {x:-1, y:0};
    if (e.key === "ArrowRight" && snake[0].dir.x !== -1)
        snake[0].dir = {x:1, y:0};
});

/* -----------------------------
   遊戲主迴圈
--------------------------------*/
function gameLoop(timestamp) {
    if (timestamp - lastMove > speed) {
        moveSnake();
        lastMove = timestamp;
    }

    draw();
    requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);

/* -----------------------------
   移動蛇
--------------------------------*/
function moveSnake() {
    let head = snake[0];

    let newHead = {
        x: head.x + head.dir.x,
        y: head.y + head.dir.y,
        dir: head.dir
    };

    // 撞牆，從另一邊出來
    newHead.x = (newHead.x + COL) % COL;
    newHead.y = (newHead.y + ROW) % ROW;

    // 吃到方塊
    if (newHead.x === tile.x && newHead.y === tile.y) {
        tile = spawnTile();
        snake.push({...snake[snake.length - 1]}); // 蛇變長
    }

    // 蛇身前進
    for (let i = snake.length - 1; i > 0; i--) {
        snake[i] = {...snake[i-1]};
    }
    snake[0] = newHead;
}

/* -----------------------------
   畫面繪製
--------------------------------*/
function draw() {
    ctx.clearRect(0,0,500,500);

    // 畫蛇
    ctx.fillStyle = "#00FF66";
    for (let s of snake) {
        ctx.fillRect(s.x*GRID, s.y*GRID, GRID, GRID);
    }

    // 畫方塊
    ctx.fillStyle = "#FFCC00";
    ctx.fillRect(tile.x*GRID, tile.y*GRID, GRID, GRID);

    ctx.fillStyle = "black";
    ctx.font = "16px Arial";
    ctx.fillText(tile.value, tile.x*GRID + 7, tile.y*GRID + 18);
}
</script>

</body>
</html>
